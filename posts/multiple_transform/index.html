<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>倍数ゼータ・メビウス変換のメモ - Niue&#39;z Blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="倍数ゼータ・メビウス変換のメモ" />
<meta property="og:description" content="約数ゼータ・メビウス変換に続いて、倍数もメモします。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://niuez.github.io/posts/multiple_transform/" />
<meta property="article:published_time" content="2022-04-19T12:00:00+09:00" />
<meta property="article:modified_time" content="2022-04-19T12:00:00+09:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="倍数ゼータ・メビウス変換のメモ"/>
<meta name="twitter:description" content="約数ゼータ・メビウス変換に続いて、倍数もメモします。"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://niuez.github.io/css/highlight-native.css">

	<link rel="stylesheet" type="text/css" media="screen" href="https://niuez.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://niuez.github.io/css/main.css" /><link rel="stylesheet" type="text/css" href="https://niuez.github.io/css/dark.css"  />
	<link rel="stylesheet" type="text/css" href="https://niuez.github.io/css/custom-dark.css"  />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://niuez.github.io/js/main.js"></script>

  <script type="text/javascript" src="https://s.hatena.ne.jp/js/HatenaStar.js"></script>
  <script type="text/javascript">
  Hatena.Star.Token = 'e2714bc09c0f22d36f9bea483e4c3efc2846d9e9';
  Hatena.Star.SiteConfig = {
    entryNodes: {
      'div.article-footer': {
        uri: 'a',
        title: 'h1',
        container: 'div'
      }
    }
  };
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
  <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
              showMathMenu: false, //disables context menu
              tex2jax: {
              inlineMath: [ ['$','$'], ['\\(','\\)'] ]
             }
      });
  </script>

</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://niuez.github.io/">
	<h1 class="site-title"><a href="https://niuez.github.io/">Niue&#39;z Blog</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"><a href="https://github.com/niuez" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/xiuez" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">倍数ゼータ・メビウス変換のメモ</h1>
			<div class="meta">Posted at &mdash; Apr 19, 2022</div>
		</div>

		<div class="markdown">
			<p><a href="https://niuez.github.io/posts/divisor_transform2/">約数ゼータ・メビウス変換</a>に続いて、倍数もメモします。</p>
<h2 id="倍数ゼータメビウス変換">倍数ゼータ・メビウス変換</h2>
<p>関数$f(n)$に対する倍数ゼータ変換は以下の定義です。$n | m$は「$m$は$n$の倍数」という意味で、$m$はmultipleのmです。</p>
<p>$$
F(n) = \sum_{ n | m } f(m)
$$</p>
<p>倍数ゼータ変換の逆操作が倍数メビウス変換です。</p>
<h2 id="倍数ゼータメビウス変換の実装">倍数ゼータ・メビウス変換の実装</h2>
<p><a href="https://noshi91.hatenablog.com/entry/2018/12/27/121649">高速ゼータ変換の約数版 O(N log(log(N))) - noshi91のメモ</a>を参考にすると早い実装が得られます。</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">multiple_transform</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">sieve</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">true</span><span class="p">)</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sieve</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">p</span><span class="p">;</span> <span class="n">k</span> <span class="o">!</span><span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">-</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sieve</span><span class="p">[</span><span class="n">k</span> <span class="o">*</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span> <span class="o">*</span> <span class="n">p</span><span class="p">]</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">i</span> <span class="o">!</span><span class="o">=</span> <span class="n">n</span><span class="p">;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">inverse_multiple_transform</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">sieve</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">true</span><span class="p">)</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">i</span> <span class="o">!</span><span class="o">=</span> <span class="n">n</span><span class="p">;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span><span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sieve</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">*</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">+</span><span class="o">+</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sieve</span><span class="p">[</span><span class="n">k</span> <span class="o">*</span> <span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span><span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span> <span class="o">*</span> <span class="n">p</span><span class="p">]</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="gcdとの関連">gcdとの関連</h2>
<p>$f(n)$の定義が「$\gcd$が$n$となる集合についての対応する値の総和」、つまり下のような式の形をしていたとしましょう。</p>
<p>$$
f(n) = \sum_{n = \gcd(S)} g(S)
$$</p>
<p>これの倍数ゼータ変換$F(n)$を考えると</p>
<p>$$
\begin{align}
F(n) = &amp; \sum_{n | m} \sum_{m = \gcd(S)} g(S) \\<br>
= &amp; \sum_{n | \gcd(S)} g(S) \\<br>
= &amp; \sum_{n | S_0, n | S_1, \cdots} g(S) \\<br>
\end{align}
$$</p>
<p>となって、すべての要素が$n$を約数にもつような集合$S$についての計算になります。<br>
これがかなりいい性質で、数$A$の約数列挙は$O(\sqrt A)$でできるので、
$F(n)$の$n$それぞれについての計算が高速にできる場合があります。</p>
<h2 id="agc038-c---lcms">AGC038 C - LCMs</h2>
<p><a href="https://atcoder.jp/contests/agc038/tasks/agc038_c">AGC038 C - LCMs</a></p>
<p>$$
\begin{align}
&amp; \sum_{i = 0}^{N - 1} \sum_{j = 0}^{i - 1} \operatorname{lcm}(A_i, A_j) \\<br>
= &amp; \sum_{i = 0}^{N - 1} \sum_{j = 0}^{i - 1} \frac{A_i A_j}{\gcd(A_i, A_j)} \\<br>
\end{align}
$$</p>
<p>ここで、$g = \gcd(A_i, A_j)$となる$i, j \ (i &lt; j)$それぞれについてまとめて計算することにします。</p>
<p>$$
\begin{align}
= &amp; \sum_{g} \sum_{g = gcd(A_i, A_j), i &lt; j} \frac{A_i A_j}{g} \\<br>
= &amp; \sum_{g} \frac{1}{g} \sum_{g = gcd(A_i, A_j), i &lt; j} A_i A_j \\<br>
\end{align}
$$</p>
<p>$f(g) = \sum_{g = gcd(A_i, A_j), i &lt; j} A_i A_j$として、これを倍数ゼータ変換をした$F(n)$を考えましょう。</p>
<p>$$
\begin{align}
F(n) &amp; = \sum_{n | m} f(m) \\<br>
&amp; = \sum_{n | m} \sum_{m = \gcd(A_i, A_j), i &lt; j} A_i A_j \\<br>
&amp; = \sum_{n | \gcd(A_i, A_j), i &lt; j} A_i A_j \\<br>
&amp; = \sum_{n | A_i, n | A_j, i &lt; j} A_i A_j \\<br>
&amp; = \frac{1}{2} ((\sum_{n | A_i} A_i)^2 - \sum_{n | A_i} A_i^2)
\end{align}
$$</p>
<p>$\sum_{n | A_i} A_i$と$\sum_{n | A_i} A_i^2$は、各$i$について$A_i$の約数を列挙すれば計算できて、全体で$O(N \sqrt A)$で計算できます。あとは計算した$F(n)$を倍数メビウス変換にかければ$f(n)$が得られます。</p>
<p><a href="https://atcoder.jp/contests/agc038/submissions/31088763">提出コード</a></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">constexpr</span> <span class="n">i64</span> <span class="n">MAX</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">ios</span><span class="o">:</span><span class="o">:</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">fp</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">(</span><span class="n">MAX</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">fp</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">(</span><span class="n">MAX</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i64</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span> <span class="n">d</span><span class="o">+</span><span class="o">+</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">d</span> <span class="o">=</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">S</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span><span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span> <span class="o">!</span><span class="o">=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">S</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
          <span class="n">ans</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">]</span> <span class="o">-</span><span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">fp</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">.</span><span class="n">inv</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">;</span>
    <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span><span class="o">=</span> <span class="n">i2</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="n">inverse_multiple_transform</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">fp</span> <span class="n">res</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">res</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="p">.</span><span class="n">inv</span><span class="p">(</span><span class="p">)</span> <span class="o">*</span> <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">res</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="ちなみに">ちなみに&hellip;</h2>
<p>$\sum_{n | A_i} A_i$は倍数ゼータ変換の形をしているので、この計算を倍数ゼータ変換して求めることで高速に計算できます。これがいわゆる$\gcd$畳み込みです。</p>
<p><a href="https://atcoder.jp/contests/agc038/submissions/31088850">提出コード</a></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">constexpr</span> <span class="n">i64</span> <span class="n">MAX</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">ios</span><span class="o">:</span><span class="o">:</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">fp</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">(</span><span class="n">MAX</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">S</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">multiple_transform</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="n">inverse_multiple_transform</span><span class="p">(</span><span class="n">S</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">fp</span> <span class="n">res</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">res</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="p">.</span><span class="n">inv</span><span class="p">(</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">res</span> <span class="o">-</span><span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">res</span> <span class="o">/</span> <span class="n">fp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="ちなみに2">ちなみに&hellip;2</h2>
<p>約数を列挙する部分でosa_k法を用いるとめちゃ速くなります。</p>
<p><a href="https://atcoder.jp/contests/agc038/submissions/31096016">提出コード</a></p>
<p>osa_kの実装は<a href="https://qiita.com/rsk0315_h4x/items/ff3b542a4468679fb409">えびちゃんのエラトステネスの篩に基づく高速な素因数分解 - Qiita</a>を参考にしました。</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="nc">osa_k</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">int_type</span> <span class="o">=</span> <span class="kt">int</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">int_type</span><span class="o">&gt;</span> <span class="n">min_fact</span><span class="p">;</span>
 
  <span class="c1">// O(NlogN)
</span><span class="c1"></span>  <span class="k">static</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">int_type</span><span class="o">&gt;</span> <span class="n">min_prime_factor</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">int_type</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="p">;</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">iota</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">begin</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="p">,</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">end</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">j</span> <span class="o">+</span><span class="o">=</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span><span class="o">=</span> <span class="n">j</span><span class="p">)</span> <span class="n">res</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">min_fact</span> <span class="o">=</span> <span class="n">min_prime_factor</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="c1">// O(logN)
</span><span class="c1"></span>  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">int_type</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">prime_factors</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">int_type</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">res</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">empty</span><span class="p">(</span><span class="p">)</span> <span class="o">|</span><span class="o">|</span> <span class="n">res</span><span class="p">.</span><span class="n">back</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">first</span> <span class="o">!</span><span class="o">=</span> <span class="n">min_fact</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">res</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="p">{</span> <span class="n">min_fact</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">res</span><span class="p">.</span><span class="n">back</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">second</span><span class="o">+</span><span class="o">+</span><span class="p">;</span>
      <span class="n">n</span> <span class="o">/</span><span class="o">=</span> <span class="n">min_fact</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">res</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="c1">// The divisors are not sorted
</span><span class="c1"></span>  <span class="c1">// O(logN + |divisors|)
</span><span class="c1"></span>  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
  <span class="kt">void</span> <span class="n">enumerate_divisors</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">F</span> <span class="n">f</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">int_type</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">prime_facts</span> <span class="o">=</span> <span class="n">prime_factors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">prime_facts</span><span class="p">.</span><span class="n">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">prime_facts</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
    <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">acc</span><span class="p">(</span><span class="n">prime_facts</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="p">{</span>
      <span class="n">f</span><span class="p">(</span><span class="n">acc</span><span class="p">.</span><span class="n">front</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">prime_facts</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="o">+</span><span class="p">)</span> <span class="o">=</span><span class="o">=</span> <span class="n">prime_facts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span><span class="o">=</span> <span class="n">prime_facts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span><span class="o">=</span> <span class="n">prime_facts</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span><span class="o">-</span><span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>

<span class="p">.</span><span class="p">.</span><span class="p">.</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">ios</span><span class="o">:</span><span class="o">:</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
 
  <span class="n">osa_k</span> <span class="n">osa</span><span class="p">;</span>
  <span class="n">osa</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">MAX</span><span class="p">)</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">fp</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">(</span><span class="n">MAX</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">fp</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">(</span><span class="n">MAX</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">osa</span><span class="p">.</span><span class="n">enumerate_divisors</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="p">(</span><span class="kt">int</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">S</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span> <span class="o">*</span> <span class="n">fp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">fp</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">.</span><span class="n">inv</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">;</span>
    <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span><span class="o">=</span> <span class="n">i2</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="n">inverse_multiple_transform</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span><span class="p">;</span>
 
  <span class="n">fp</span> <span class="n">res</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">MAX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">res</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="p">.</span><span class="n">inv</span><span class="p">(</span><span class="p">)</span> <span class="o">*</span> <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">res</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="abc248-g---gcd-cost-on-the-tree">ABC248 G - GCD cost on the tree</h2>
<p><a href="https://atcoder.jp/contests/abc248/tasks/abc248_g">ABC248 G - GCD cost on the tree</a></p>
<p>$P(i, j)$を$(i, j)$パス上の頂点の$A$の値の集合、$d(i, j)$を$(i, j)$パスの長さとすると、</p>
<p>$$
\begin{align}
\sum_{i &lt; j} (d(i, j) + 1) \gcd(P(i, j))
\end{align}
$$</p>
<p>が答えです。ここから変形していきます。</p>
<p>$$
\begin{align}
= &amp; \sum_{g} \sum_{g = \gcd(P(i, j)), i &lt; j} (d(i, j) + 1) g \\<br>
= &amp; \sum_{g} g \sum_{g = \gcd(P(i, j)), i &lt; j} (d(i, j) + 1) \\<br>
\end{align}
$$</p>
<p>$f(g) = \sum_{g = \gcd(P(i, j)), i &lt; j} (d(i, j) + 1)$として、これの倍数ゼータ変換$F(n)$を考えましょう。</p>
<p>$$
\begin{align}
F(n) = &amp; \sum_{n | m} \sum_{m = \gcd(P(i, j)), i &lt; j} (d(i, j) + 1) \\<br>
= &amp; \sum_{n | \gcd(P(i, j)), i &lt; j} (d(i, j) + 1) \\<br>
= &amp; \sum_{P(i, j)の全ての要素はnを約数にもつ, i &lt; j} (d(i, j) + 1)
\end{align}
$$</p>
<p>なので、$A_i$が$n$を約数にもつような頂点$i$だけからなるグラフを考えると計算できそうです。パスの長さの総和は、各辺を合計何回通るかで計算できます。<br>
dfs戻りがけを意識して実装すると簡単です。</p>
<p>あとは同様に$F(n)$を倍数メビウス変換をすれば、$f(n)$が求まります。</p>
<p><a href="https://atcoder.jp/contests/abc248/submissions/31087608">提出コード</a></p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="n">i64</span> <span class="n">N</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">G</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">dv</span><span class="p">(</span><span class="mf">1e5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="p">;</span>
 
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
 
<span class="kt">void</span> <span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">g</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span><span class="o">&amp;</span> <span class="n">cnt</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">i64</span> <span class="n">now</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">u</span><span class="p">:</span> <span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span><span class="o">=</span> <span class="n">p</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">%</span> <span class="n">g</span> <span class="o">!</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="n">dfs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span><span class="p">;</span>
    <span class="n">now</span> <span class="o">+</span><span class="o">=</span> <span class="n">cnt</span><span class="p">.</span><span class="n">back</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cnt</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">now</span><span class="p">)</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">N</span><span class="p">;</span>
  <span class="n">A</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">G</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">i64</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">u</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
    <span class="n">u</span><span class="o">-</span><span class="o">-</span><span class="p">;</span>
    <span class="n">v</span><span class="o">-</span><span class="o">-</span><span class="p">;</span>
    <span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">;</span>
    <span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i64</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span> <span class="n">d</span><span class="o">+</span><span class="o">+</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">d</span> <span class="o">=</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dv</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span> <span class="o">!</span><span class="o">=</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">dv</span><span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">]</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">fp</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">(</span><span class="n">dv</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="n">vis</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">dv</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span> <span class="n">dv</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">)</span><span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span><span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">;</span>
        <span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">cnt</span><span class="p">)</span><span class="p">;</span>
        <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">cnt</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span> <span class="o">*</span> <span class="n">fp</span><span class="p">(</span><span class="n">cnt</span><span class="p">.</span><span class="n">back</span><span class="p">(</span><span class="p">)</span> <span class="o">-</span> <span class="n">cnt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">cnt</span><span class="p">.</span><span class="n">back</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="o">*</span> <span class="n">fp</span><span class="p">(</span><span class="n">cnt</span><span class="p">.</span><span class="n">back</span><span class="p">(</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">fp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">v</span><span class="p">:</span> <span class="n">dv</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">inverse_multiple_transform</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span><span class="p">;</span>
  <span class="n">fp</span> <span class="n">res</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">dv</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">res</span> <span class="o">+</span><span class="o">=</span> <span class="n">fp</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">res</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

    <div class="article-footer">
      <a style="display:none;" href="https://niuez.github.io/posts/multiple_transform/"></a>
      <h1 style="display:none;">倍数ゼータ・メビウス変換のメモ</h1>
      <div></div>
    </div>
		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/algorithm">Algorithm</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	
<div class="footer wrapper">
	<nav class="nav">
		<div> This site use Google Analytics |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-157596444-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
