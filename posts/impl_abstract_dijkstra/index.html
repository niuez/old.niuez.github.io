<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>グラフ, 格子状のグラフ, 次元拡張グラフを同じコードで扱う抽象化BFS, DijkstraのC&#43;&#43;14実装 - Niue&#39;z Blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="グラフ, 格子状のグラフ, 次元拡張グラフを同じコードで扱う抽象化BFS, DijkstraのC&#43;&#43;14実装" />
<meta property="og:description" content="これすごく悩んでいたんですけど, 新しい実装法を考えたらスッキリしたのでまとめます." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://niuez.github.io/posts/impl_abstract_dijkstra/" />
<meta property="article:published_time" content="2020-04-27T01:08:48+09:00" />
<meta property="article:modified_time" content="2020-04-27T01:08:48+09:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="グラフ, 格子状のグラフ, 次元拡張グラフを同じコードで扱う抽象化BFS, DijkstraのC&#43;&#43;14実装"/>
<meta name="twitter:description" content="これすごく悩んでいたんですけど, 新しい実装法を考えたらスッキリしたのでまとめます."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://niuez.github.io/css/highlight-native.css">

	<link rel="stylesheet" type="text/css" media="screen" href="https://niuez.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://niuez.github.io/css/main.css" /><link rel="stylesheet" type="text/css" href="https://niuez.github.io/css/dark.css"  />
	<link rel="stylesheet" type="text/css" href="https://niuez.github.io/css/custom-dark.css"  />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://niuez.github.io/js/main.js"></script>

  <script type="text/javascript" src="https://s.hatena.ne.jp/js/HatenaStar.js"></script>
  <script type="text/javascript">
  Hatena.Star.Token = 'e2714bc09c0f22d36f9bea483e4c3efc2846d9e9';
  Hatena.Star.SiteConfig = {
    entryNodes: {
      'div.article-footer': {
        uri: 'a',
        title: 'h1',
        container: 'div'
      }
    }
  };
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
  <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
              showMathMenu: false, //disables context menu
              tex2jax: {
              inlineMath: [ ['$','$'], ['\\(','\\)'] ]
             }
      });
  </script>

</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://niuez.github.io/">
	<h1 class="site-title"><a href="https://niuez.github.io/">Niue&#39;z Blog</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"><a href="https://github.com/niuez" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/xiuez" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">グラフ, 格子状のグラフ, 次元拡張グラフを同じコードで扱う抽象化BFS, DijkstraのC&#43;&#43;14実装</h1>
			<div class="meta">Posted at &mdash; Apr 27, 2020</div>
		</div>

		<div class="markdown">
			<p>これすごく悩んでいたんですけど, 新しい実装法を考えたらスッキリしたのでまとめます.</p>
<p>先駆者がいたらごめん, 勝手に<strong>にう式グラフ抽象化</strong>って言っちゃおうかな</p>
<h2 id="意思">意思</h2>
<p>DijkstraやBFSのライブラリを書いておきたい！</p>
<h2 id="問題点">問題点</h2>
<ul>
<li>同じアルゴリズムのライブラリを, 種類の違うグラフに対して一つずつ書くのは本当にイヤ</li>
<li>格子状のグラフをわざわざ, <code>std::vector&lt;std::vector&lt;int&gt;&gt; G</code>に構築するのは定数倍があるのでイヤ.</li>
<li>問題を解くために次元拡張したグラフをわざわざ構築するのは, キレイじゃない</li>
<li><code>struct edge</code>がC++においてはなんかイヤ, 隣接する頂点が<code>int to</code>で固定しないとダメだったりでイヤ(Rustのtraitとかあるならまだしも 個人差あり)</li>
<li>そもそも<code>struct edge</code>を毎回書くのもイヤ(競プロなので)</li>
<li>隣接リストを毎回<code>std::vector&lt;edge&gt;</code>で返すのもキレイじゃない, できるだけ無駄はなくしたい.</li>
</ul>
<p>どうしよう(欲求が多すぎる)</p>
<h2 id="解決">解決</h2>
<p>抽象化しにくいのはなぜかというと, <code>struct edge</code>と隣接行列の保持の仕方がグラフの種類ごとに違うからです.  なので, 方針としては</p>
<ul>
<li><code>struct edge</code>は, ライブラリに触れさせない</li>
<li>隣接行列は, 直接ライブラリに触れさせない</li>
</ul>
<p>という点を実現できれば良いです. ですが, 隣接行列を<code>std::vector&lt;なんたら&gt;</code>で返す関数を返すのも美しくありません. なので, これを関数で受けることにします.</p>
<p>具体的には,</p>
<ol>
<li>BFS関数は, <code>delta</code>という隣接行列を生成する関数を受け取ります.</li>
<li>隣接する頂点を列挙する時は, <code>delta</code>に, 現在の頂点$v$と, <strong>$v$と隣接する頂点を引数にとる, 探索をする関数</strong>を渡します.</li>
<li><code>delta</code>が隣接する頂点を, 引数で渡された関数の引数に入れて探索をしてもらいます.</li>
<li>できる!</li>
</ol>
<p>Dijkstraの場合には, <code>delta</code>に渡す関数を<code>(V t /* 隣接頂点 */, W cost /* 辺のコスト */)</code>にしておけばOKですね.</p>
<p>頂点の抽象化は, <code>index(V) -&gt; int</code>があればいいです.</p>
<h2 id="コード">コード</h2>
<h3 id="bfs">BFS</h3>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp"></span><span class="k">using</span> <span class="n">i64</span> <span class="o">=</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">;</span>

<span class="cm">/*
</span><span class="cm"> * delta(V v, fn (V t))
</span><span class="cm"> * index(V v) -&gt; int
</span><span class="cm"> */</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">V</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Delta</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Index</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">bfs</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">size_t</span> <span class="n">N</span><span class="p">,</span> <span class="n">V</span> <span class="n">s</span><span class="p">,</span> <span class="n">Delta</span> <span class="n">delta</span><span class="p">,</span> <span class="n">Index</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">dist</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">que</span><span class="p">;</span>
  <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">que</span><span class="p">.</span><span class="n">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">V</span> <span class="n">v</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">front</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">que</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="n">delta</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="p">(</span><span class="n">V</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">]</span> <span class="o">=</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">dist</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3 id="dijkstra">Dijkstra</h3>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="cp"></span><span class="cp">#</span><span class="cp">include</span> <span class="cpf">&lt;queue&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="cm">/*
</span><span class="cm"> * delta(V v, fn (V t, W weight))
</span><span class="cm"> * index(V v) -&gt; int
</span><span class="cm"> */</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">V</span><span class="p">,</span> <span class="k">class</span> <span class="nc">W</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Delta</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Index</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">W</span><span class="o">&gt;</span> <span class="n">dijkstra</span><span class="p">(</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">size_t</span> <span class="n">N</span><span class="p">,</span> <span class="n">W</span> <span class="n">inf</span><span class="p">,</span> <span class="n">V</span> <span class="n">s</span><span class="p">,</span> <span class="n">Delta</span> <span class="n">delta</span><span class="p">,</span> <span class="n">Index</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">W</span><span class="o">&gt;</span> <span class="n">dist</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">inf</span><span class="p">)</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">P</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">W</span><span class="p">,</span> <span class="n">V</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">P</span><span class="p">,</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">greater</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">que</span><span class="p">;</span>
  <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="p">{</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">s</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">que</span><span class="p">.</span><span class="n">empty</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">W</span> <span class="n">d</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">top</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
    <span class="n">V</span> <span class="n">v</span> <span class="o">=</span> <span class="n">que</span><span class="p">.</span><span class="n">top</span><span class="p">(</span><span class="p">)</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
    <span class="n">que</span><span class="p">.</span><span class="n">pop</span><span class="p">(</span><span class="p">)</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="n">delta</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="p">(</span><span class="n">V</span> <span class="n">t</span><span class="p">,</span> <span class="n">W</span> <span class="n">weight</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">que</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="p">{</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="p">,</span> <span class="n">t</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">dist</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3 id="how-to-use">How To Use</h3>
<p>格子グラフに関しては, こんな感じに予めライブラリを書いておくと楽です.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nc">lattice_delta</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">;</span>
  <span class="n">F</span> <span class="n">f</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">P</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">i64</span><span class="p">,</span> <span class="n">i64</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">lattice_delta</span><span class="p">(</span><span class="n">i64</span> <span class="n">H</span><span class="p">,</span> <span class="n">i64</span> <span class="n">W</span><span class="p">,</span> <span class="n">F</span> <span class="n">f</span><span class="p">)</span><span class="o">:</span> <span class="n">H</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="p">,</span> <span class="n">W</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span><span class="p">}</span>
  <span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Func</span><span class="o">&gt;</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="p">(</span><span class="p">)</span><span class="p">(</span><span class="n">P</span> <span class="n">v</span><span class="p">,</span> <span class="n">Func</span> <span class="n">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="k">static</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">dx</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span><span class="p">;</span>
    <span class="n">i64</span> <span class="n">i</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
    <span class="n">i64</span> <span class="n">j</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i64</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">q</span><span class="o">+</span><span class="o">+</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">i64</span> <span class="n">x</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">dx</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="p">;</span>
      <span class="n">i64</span> <span class="n">y</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">dx</span><span class="p">[</span><span class="n">q</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">x</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">H</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="mi">0</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">y</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">W</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">f</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="p">,</span> <span class="n">P</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>
 
<span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
<span class="n">lattice_delta</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span> <span class="n">make_lattice_delta</span><span class="p">(</span><span class="n">i64</span> <span class="n">H</span><span class="p">,</span> <span class="n">i64</span> <span class="n">W</span><span class="p">,</span> <span class="n">F</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lattice_delta</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="p">;</span> <span class="p">}</span>
 
<span class="k">struct</span> <span class="nc">lattice_index</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">P</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">i64</span><span class="p">,</span> <span class="n">i64</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">lattice_index</span><span class="p">(</span><span class="n">i64</span> <span class="n">H</span><span class="p">,</span> <span class="n">i64</span> <span class="n">W</span><span class="p">)</span><span class="o">:</span> <span class="n">H</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="p">,</span> <span class="n">W</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="p">{</span><span class="p">}</span>
  <span class="n">i64</span> <span class="nf">operator</span><span class="p">(</span><span class="p">)</span><span class="p">(</span><span class="n">P</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">v</span><span class="p">.</span><span class="n">first</span> <span class="o">*</span> <span class="n">W</span> <span class="o">+</span> <span class="n">v</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span><span class="p">;</span>
</code></pre></div><p>これで, <a href="https://atcoder.jp/contests/abc151/tasks/abc151_d">Maze Master</a>は以下のように解くことができます.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">H</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">W</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">i64</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">using</span> <span class="n">P</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">i64</span><span class="p">,</span> <span class="n">i64</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">make_lattice_delta</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="p">(</span><span class="n">P</span> <span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="n">t</span><span class="p">,</span> <span class="k">auto</span> <span class="n">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">first</span><span class="p">]</span><span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span><span class="o">=</span> <span class="sa"></span><span class="sc">&#39;</span><span class="sc">.</span><span class="sc">&#39;</span><span class="p">)</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">)</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">index</span> <span class="o">=</span> <span class="n">lattice_index</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span><span class="p">;</span>

  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">)</span> <span class="n">rep</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">W</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span><span class="o">=</span> <span class="sa"></span><span class="sc">&#39;</span><span class="sc">#</span><span class="sc">&#39;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">res</span> <span class="o">=</span> <span class="n">bfs</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">W</span><span class="p">,</span> <span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span><span class="p">;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="o">*</span><span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">max_element</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="p">)</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">ans</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>また, 次元拡張グラフを扱う<a href="https://atcoder.jp/contests/abc164/tasks/abc164_e">E - Two Currencies</a>は, こんな感じで.</p>
<div class="highlight"><pre class="chroma"><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">i64</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">S</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">N</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">M</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">S</span><span class="p">;</span>
  <span class="n">S</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">min</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="mi">2500ll</span><span class="p">)</span><span class="p">;</span>
 
  <span class="k">struct</span> <span class="nc">edge</span> <span class="p">{</span>
    <span class="n">i64</span> <span class="n">to</span><span class="p">;</span>
    <span class="n">i64</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">i64</span> <span class="n">b</span><span class="p">;</span>
  <span class="p">}</span><span class="p">;</span>
 
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">edge</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">G</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">i64</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">u</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">v</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">u</span><span class="o">-</span><span class="o">-</span><span class="p">;</span>
    <span class="n">v</span><span class="o">-</span><span class="o">-</span><span class="p">;</span>
    <span class="n">G</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="p">{</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>
    <span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="p">{</span> <span class="n">u</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">}</span><span class="p">)</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">C</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">i64</span><span class="o">&gt;</span> <span class="n">D</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cin</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="k">using</span> <span class="n">P</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">i64</span><span class="p">,</span> <span class="n">i64</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="p">(</span><span class="n">P</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">*</span> <span class="mi">2501</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span><span class="p">;</span> <span class="p">}</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">delta</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span><span class="p">(</span><span class="n">P</span> <span class="n">vv</span><span class="p">,</span> <span class="k">auto</span> <span class="n">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">i64</span> <span class="n">v</span> <span class="o">=</span> <span class="n">vv</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
    <span class="n">i64</span> <span class="n">c</span> <span class="o">=</span> <span class="n">vv</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
    <span class="n">func</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">min</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">C</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="p">,</span> <span class="mi">2500ll</span><span class="p">)</span><span class="p">)</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">e</span><span class="p">:</span> <span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">a</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">func</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">to</span><span class="p">,</span> <span class="n">c</span> <span class="o">-</span> <span class="n">e</span><span class="p">.</span><span class="n">a</span><span class="p">)</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">b</span><span class="p">)</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">res</span> <span class="o">=</span> <span class="n">dijkstra</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="mi">2501</span><span class="p">,</span> <span class="p">(</span><span class="n">i64</span><span class="p">)</span><span class="p">(</span><span class="mf">1e17</span><span class="p">)</span><span class="p">,</span> <span class="n">P</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span><span class="p">;</span>
  <span class="n">rep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">i64</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">)</span><span class="p">]</span><span class="p">;</span>
    <span class="n">rep</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2501</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">ans</span> <span class="o">=</span> <span class="n">std</span><span class="o">:</span><span class="o">:</span><span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="n">index</span><span class="p">(</span><span class="n">P</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="p">)</span><span class="p">]</span><span class="p">)</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">ans</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="sa"></span><span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>C++14ならジェネリックラムダあるので, <code>auto func</code>って書き殴れるのでいいですね.</p>
<h2 id="提出ページ">提出ページ</h2>
<ul>
<li>格子グラフのBFS: <a href="https://atcoder.jp/contests/abc151/submissions/11773027">D - Maze Master - 提出 #11773027 - AtCoder Beginner Contest 151</a> ちょっとコード違うけど許して</li>
<li>格子グラフの01dial(01-bfs): <a href="https://atcoder.jp/contests/agc043/submissions/11773947">A - Range Flip Find Route - 提出 #11773947 - AtCoder Grand Contest 043</a></li>
<li>次元拡張グラフのDijkstra: <a href="https://atcoder.jp/contests/abc164/submissions/12401080">E - Two Currencies - 提出 #12401080 - AtCoder Beginner Contest 164</a></li>
</ul>


    <div class="article-footer">
      <a style="display:none;" href="https://niuez.github.io/posts/impl_abstract_dijkstra/"></a>
      <h1 style="display:none;">グラフ, 格子状のグラフ, 次元拡張グラフを同じコードで扱う抽象化BFS, DijkstraのC&#43;&#43;14実装</h1>
      <div></div>
    </div>
		</div>

		<div class="post-tags">
			
				
					<nav class="nav tags">
							<ul class="flat">
								
								<li><a href="/tags/algorithm">Algorithm</a></li>
								
							</ul>
					</nav>
				
			
		</div>
		</div>
	
<div class="footer wrapper">
	<nav class="nav">
		<div> This site use Google Analytics |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-157596444-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<script>feather.replace()</script>
</body>
</html>
